<!DOCTYPE html>
<!--
  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
  ‚ïë                                                                                  ‚ïë
  ‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó         ‚ïë
  ‚ïë        ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù         ‚ïë
  ‚ïë        ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó           ‚ïë
  ‚ïë        ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù           ‚ïë
  ‚ïë        ‚ñà‚ñà‚ïë   ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù    ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó         ‚ïë
  ‚ïë        ‚ïö‚ïê‚ïù    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù      ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù     ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù         ‚ïë
  ‚ïë                                                                                  ‚ïë
  ‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó     ‚ïë
  ‚ïë        ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïî‚ïù     ‚ïë
  ‚ïë        ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù      ‚ïë
  ‚ïë        ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù      ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó  ‚ïö‚ñà‚ñà‚ïî‚ïù       ‚ïë
  ‚ïë        ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó    ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë        ‚ïë
  ‚ïë        ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù     ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù        ‚ïë
  ‚ïë                                                                                  ‚ïë
  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
  
  Synthetic Order Book
  
  Copyright (c) 2025 Daniel Boorn <daniel.boorn@gmail.com>
  
  This software is free for personal, non-commercial use only.
  Commercial reproduction or distribution is prohibited without license.
  For commercial licensing inquiries, contact daniel.boorn@gmail.com
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Synthetic Order Book</title>
    
    <!-- PWA / Add to Home Screen -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0e17">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="OrderBook">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23111827'/%3E%3Cstop offset='100%25' stop-color='%230a0e17'/%3E%3C/linearGradient%3E%3ClinearGradient id='glow' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%233b82f6'/%3E%3Cstop offset='100%25' stop-color='%238b5cf6'/%3E%3C/linearGradient%3E%3ClinearGradient id='green' x1='0%25' y1='100%25' x2='0%25' y2='0%25'%3E%3Cstop offset='0%25' stop-color='%23059669'/%3E%3Cstop offset='100%25' stop-color='%2310b981'/%3E%3C/linearGradient%3E%3ClinearGradient id='red' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23dc2626'/%3E%3Cstop offset='100%25' stop-color='%23ef4444'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23bg)' width='180' height='180' rx='36'/%3E%3Crect x='6' y='6' width='168' height='168' rx='32' fill='none' stroke='url(%23glow)' stroke-width='1.5' opacity='0.4'/%3E%3Crect x='28' y='90' width='15' height='48' rx='3' fill='url(%23green)'/%3E%3Crect x='31' y='76' width='9' height='14' fill='%2310b981'/%3E%3Crect x='31' y='138' width='9' height='11' fill='%2310b981'/%3E%3Crect x='50' y='52' width='15' height='66' rx='3' fill='url(%23red)'/%3E%3Crect x='53' y='42' width='9' height='10' fill='%23ef4444'/%3E%3Crect x='53' y='118' width='9' height='14' fill='%23ef4444'/%3E%3Crect x='72' y='66' width='15' height='52' rx='3' fill='url(%23green)'/%3E%3Crect x='75' y='52' width='9' height='14' fill='%2310b981'/%3E%3Crect x='75' y='118' width='9' height='10' fill='%2310b981'/%3E%3Crect x='94' y='48' width='15' height='62' rx='3' fill='url(%23green)'/%3E%3Crect x='97' y='34' width='9' height='14' fill='%2310b981'/%3E%3Crect x='97' y='110' width='9' height='11' fill='%2310b981'/%3E%3Crect x='116' y='58' width='15' height='48' rx='3' fill='url(%23red)'/%3E%3Crect x='119' y='48' width='9' height='10' fill='%23ef4444'/%3E%3Crect x='119' y='106' width='9' height='16' fill='%23ef4444'/%3E%3Crect x='138' y='44' width='15' height='56' rx='3' fill='url(%23green)'/%3E%3Crect x='141' y='30' width='9' height='14' fill='%2310b981'/%3E%3Crect x='141' y='100' width='9' height='10' fill='%2310b981'/%3E%3Cpath d='M24 142 Q54 124 82 118 T138 90 T160 76' stroke='url(%23glow)' stroke-width='2.5' fill='none' stroke-linecap='round' opacity='0.8'/%3E%3Ccircle cx='160' cy='76' r='4' fill='%233b82f6'/%3E%3C/svg%3E">
    
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="css/style.css?v=20251217.17">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1><span id="headerSymbol">BTC</span><span class="accent">ORDERBOOK</span></h1>
                <span class="subtitle">Synthetic Multi-Exchange</span>
            </div>
            <div class="header-center">
                <!-- Row: Quick Currency Switcher (mobile only) -->
                <div class="header-row header-row-currencies">
                    <div class="currency-quick-switch">
                        <button class="currency-btn active" data-symbol="BTC">BTC</button>
                        <button class="currency-btn" data-symbol="ETH">ETH</button>
                        <button class="currency-btn" data-symbol="SOL">SOL</button>
                        <button class="currency-btn" data-symbol="XRP">XRP</button>
                        <button class="currency-btn" data-symbol="DOGE">DOGE</button>
                        <button class="currency-btn" data-symbol="SUI">SUI</button>
                    </div>
                </div>
                <!-- Row: Symbol + Price -->
                <div class="header-row header-row-price">
                    <div class="symbol-selector">
                        <input type="text" id="symbolInput" value="BTC" placeholder="BTC" maxlength="10" title="Enter cryptocurrency symbol (e.g. BTC, ETH, SOL)">
                        <span class="symbol-slash">/USD</span>
                    </div>
                    <div class="price-display" id="priceDisplay">
                        <span class="price-value" id="currentPrice">--</span>
                    </div>
                    <button class="price-toggle" id="priceToggle" title="Toggle Price Visibility">
                    <svg class="eye-open" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    <svg class="eye-closed" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                        <line x1="1" y1="1" x2="23" y2="23"/>
                    </svg>
                </button>
                </div>
                <!-- Row: LD + Alpha (metrics) -->
                <div class="header-row header-row-metrics">
                    <div class="header-metrics">
                        <div class="header-metric" title="Liquidity Delta - Bid pressure minus Ask pressure">
                            <span class="metric-label">LD</span>
                            <span class="metric-value" id="headerLdDelta">--</span>
                        </div>
                        <div class="header-metric" title="Alpha Score - Overall market sentiment (0-100)">
                            <span class="metric-label">Œ±</span>
                            <span class="metric-value" id="headerAlpha">--</span>
                        </div>
                    </div>
                </div>
                <!-- Row: Market Consensus (mobile snapshot) -->
                <div class="header-row header-row-mcs">
                    <div class="header-mcs" id="headerMcs">
                        <div class="mcs-stripe-mini" id="headerMcsStripe"></div>
                        <span class="mcs-dot neutral"></span>
                        <span class="mcs-label">MCS</span>
                        <span class="mcs-signal" id="headerMcsSignal">WAIT</span>
                        <span class="mcs-score" id="headerMcsScore">(--/100)</span>
                        <span class="mcs-confidence" id="headerMcsConfidence">--</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="exchange-status" id="exchangeStatus">
                    <span class="status-dot"></span>
                    <span>Connecting...</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Chart Container -->
            <div class="chart-section">
                <div class="chart-header">
                    <div class="timeframe-selector">
                        <select id="timeframeSelect" class="tf-select">
                            <option value="1m">1m</option>
                            <option value="3m">3m</option>
                            <option value="5m">5m</option>
                            <option value="15m">15m</option>
                            <option value="30m">30m</option>
                            <option value="1h">1h</option>
                            <option value="2h">2h</option>
                            <option value="4h" selected>4h</option>
                            <option value="6h">6h</option>
                            <option value="12h">12h</option>
                            <option value="1d">1D</option>
                            <option value="3d">3D</option>
                            <option value="1w">1W</option>
                        </select>
                        <span class="bar-countdown" id="barCountdown" title="Time until next bar">--:--</span>
                    </div>
                    <div class="chart-controls">
                        <button class="icon-btn mobile-only" id="btnFullscreen" title="Toggle Fullscreen Chart">
                            <svg class="fullscreen-expand" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                            </svg>
                            <svg class="fullscreen-collapse" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
                            </svg>
                        </button>
                        <button class="icon-btn" id="btnLegend" title="Chart Legend">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                        </button>
                        <button class="icon-btn" id="btnChartAlert" title="Create chart alert">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                <path d="M12 9v6M9 12h6"/>
                            </svg>
                        </button>
                        <button class="icon-btn" id="btnAlerts" title="Alerts">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                <path d="M13.73 21a2 2 0 01-3.46 0"/>
                            </svg>
                            <span class="alerts-dot" id="alertsGlobalDot" aria-hidden="true"></span>
                        </button>
                        <button class="icon-btn" id="btnLevelSettings" title="Settings">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="chart-container" id="chartContainer"></div>
                <button id="goToLatestBtn" class="chart-nav-btn" title="Go to latest bar">¬ª</button>
                <!-- BB Pulse container removed - drawn on main chart -->
            </div>

            <!-- Left Sidebar - Order Flow Metrics -->
            <div class="sidebar sidebar-left" id="sidebarLeft">
                <div class="sidebar-handle" id="collapseLeftSidebar" title="Click to collapse/expand">
                    <span class="handle-bars">||</span>
                </div>
                <!-- Depth Chart -->
                <div class="panel depth-panel collapsible expanded" data-panel="depth">
                    <div class="panel-header">
                        <h3>Market Depth</h3>
                        <div class="panel-header-actions">
                            <div class="exchange-selector">
                                <span class="panel-badge clickable" id="depthSources">-</span>
                                <div class="exchange-dropdown" id="exchangeDropdown">
                                    <label class="exchange-option">
                                        <input type="checkbox" id="exKraken" checked>
                                        <span>Kraken</span>
                                    </label>
                                    <label class="exchange-option">
                                        <input type="checkbox" id="exCoinbase" checked>
                                        <span>Coinbase</span>
                                    </label>
                                    <label class="exchange-option">
                                        <input type="checkbox" id="exBitstamp" checked>
                                        <span>Bitstamp</span>
                                    </label>
                                </div>
                            </div>
                            <button class="panel-alert-btn" data-alert-section="depth" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div class="depth-chart" id="depthChart"></div>
                        <div class="depth-stats">
                            <div class="depth-stat">
                                <span class="stat-label">Bid Volume</span>
                                <span class="stat-value bid" id="totalBidVol">--</span>
                            </div>
                            <div class="depth-stat">
                                <span class="stat-label">Ask Volume</span>
                                <span class="stat-value ask" id="totalAskVol">--</span>
                            </div>
                            <div class="depth-stat">
                                <span class="stat-label">Imbalance</span>
                                <span class="stat-value" id="imbalance">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Flow Pressure Panel -->
                <div class="panel pressure-panel collapsible expanded" data-panel="orderflow">
                    <div class="panel-header">
                        <h3>Order Flow</h3>
                        <div class="panel-header-actions">
                            <span class="panel-badge" id="pressureStatus">Live</span>
                            <button class="panel-alert-btn" data-alert-section="orderflow" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                    <!-- BPR - Book Pressure Ratio -->
                    <div class="pressure-row">
                        <div class="pressure-label">
                            <span class="pressure-name">BPR
                                <span class="info-icon">?
                                    <span class="info-tooltip">
                                        <strong>Book Pressure Ratio</strong>
                                        <span class="tip-formula">BPR = Bid Vol √∑ Ask Vol</span>
                                        <span class="tip-bullish">‚ñ≤ &gt;1.0 = More bids (bullish)</span><br>
                                        <span class="tip-bearish">‚ñº &lt;1.0 = More asks (bearish)</span><br>
                                        ~1.0 = Balanced book
                                    </span>
                                </span>
                            </span>
                            <span class="pressure-hint">Bid/Ask Ratio</span>
                        </div>
                        <div class="pressure-gauge">
                            <div class="bpr-gauge">
                                <div class="bpr-bar bid" id="bprBarBid"></div>
                                <div class="bpr-bar ask" id="bprBarAsk"></div>
                                <div class="bpr-center"></div>
                            </div>
                            <span class="pressure-value" id="bprValue">1.00</span>
                        </div>
                    </div>
                    <div class="indicator-analysis" id="bprAnalysis">Balanced order book</div>
                    
                    <!-- LD - Liquidity Delta (Enhanced) -->
                    <div class="pressure-row">
                        <div class="pressure-label">
                            <span class="pressure-name">LD
                                <span class="info-icon">?
                                    <span class="info-tooltip">
                                        <strong>Liquidity Delta (Killer Indicator)</strong>
                                        <span class="tip-formula">LD = Œ£(Bids√óWeight) - Œ£(Asks√óWeight)</span>
                                        Weighted by proximity ‚Äî closer orders matter more.<br><br>
                                        <span class="tip-bullish">‚ñ≤ Positive = Bid pressure</span><br>
                                        <span class="tip-bearish">‚ñº Negative = Ask pressure</span><br>
                                        Watch for <em>changes</em> in LD to predict moves.
                                    </span>
                                </span>
                            </span>
                            <span class="pressure-hint">Liquidity Delta</span>
                        </div>
                        <div class="pressure-delta">
                            <span class="delta-value" id="ldValue">0</span>
                            <span class="delta-unit" id="ldUnit">BTC</span>
                            <span class="delta-arrow" id="ldArrow">‚Üí</span>
                        </div>
                    </div>
                    <div class="indicator-analysis" id="ldAnalysis">Neutral liquidity balance</div>
                    
                    <!-- LD Enhanced Metrics -->
                    <div class="ld-enhanced-section">
                        <!-- LD Velocity -->
                        <div class="ld-metric-row">
                            <span class="ld-metric-label">
                                LD_VEL
                                <span class="info-icon small">?
                                    <span class="info-tooltip">
                                        <strong>LD Velocity</strong>
                                        Measures how much pressure comes from <em>near-price</em> orders.<br><br>
                                        <span class="tip-bullish">üü¢ Green = Real pressure (near price)</span><br>
                                        <span class="tip-bearish">üî¥ Red = Possible spoof (far orders)</span><br>
                                        <span class="tip-neutral">üü° Yellow = Mixed signals</span>
                                    </span>
                                </span>
                            </span>
                            <div class="ld-velocity-gauge">
                                <div class="velocity-bar-container">
                                    <div class="velocity-bar" id="ldVelocityBar"></div>
                                </div>
                                <span class="ld-metric-value" id="ldVelocity">0</span>
                            </div>
                        </div>
                        
                        <!-- LD Cluster -->
                        <div class="ld-metric-row">
                            <span class="ld-metric-label">
                                LD_CLU
                                <span class="info-icon small">?
                                    <span class="info-tooltip">
                                        <strong>LD Cluster Strength</strong>
                                        LD weighted by order clustering density.<br><br>
                                        Clustered orders = real walls<br>
                                        Scattered orders = noise/spoofs<br>
                                        <span class="tip-bullish">Green outline = Cluster-backed</span><br>
                                        <span class="tip-neutral">Thin text = Unclustered</span>
                                    </span>
                                </span>
                            </span>
                            <div class="ld-velocity-gauge">
                                <div class="velocity-bar-container">
                                    <div class="velocity-bar cluster-bar" id="ldClusterBar"></div>
                                </div>
                                <span class="ld-metric-value" id="ldCluster">0</span>
                            </div>
                        </div>
                        
                        <!-- LD Projection (3-bar forecast) -->
                        <div class="ld-metric-row">
                            <span class="ld-metric-label">
                                PROJ
                                <span class="info-icon small">?
                                    <span class="info-tooltip">
                                        <strong>LD Projection</strong>
                                        3-bar forecast of future LD values.<br><br>
                                        Dots show expected LD in +1, +2, +3 bars.<br>
                                        <span class="tip-bullish">Green = Bullish drift expected</span><br>
                                        <span class="tip-bearish">Red = Bearish drift expected</span>
                                    </span>
                                </span>
                            </span>
                            <div class="ld-projection-dots" id="ldProjection">
                                <span class="proj-dot neutral">0</span>
                                <span class="proj-dot neutral">0</span>
                                <span class="proj-dot neutral">0</span>
                            </div>
                        </div>
                        
                        <!-- LD Heatmap (Pressure Map) -->
                        <div class="ld-metric-row ld-heatmap-row">
                            <span class="ld-metric-label">
                                PRESS
                                <span class="info-icon small">?
                                    <span class="info-tooltip">
                                        <strong>LD Pressure Map</strong>
                                        Shows where bid/ask pressure is concentrated.<br><br>
                                        Left = Below price, Right = Above price<br>
                                        <span class="tip-bullish">Cyan bars = Bid pressure (support)</span><br>
                                        <span class="tip-bearish">Pink bars = Ask pressure (resistance)</span>
                                    </span>
                                </span>
                            </span>
                            <div class="ld-heatmap-container" id="ldHeatmap"></div>
                        </div>
                        
                        <!-- Absorption/Displacement & Divergence -->
                        <div class="ld-signals-row">
                            <span class="ld-signal" id="ldAbsorption"></span>
                            <span class="ld-signal" id="ldDivergence"></span>
                        </div>
                        
                        <!-- Market Maker Model -->
                        <div class="ld-mm-row">
                            <span class="ld-mm-signal" id="ldMM"></span>
                        </div>
                        
                        <!-- LD Alerts -->
                        <div class="ld-alerts-row" id="ldAlerts"></div>
                    </div>
                    
                    <!-- LD Trading Guide -->
                    <div class="ld-trading-guide">
                        <div class="guide-header" id="ldGuideToggle">
                            <span class="guide-arrow">‚ñ∂</span>
                            <span class="guide-title">LD TRADING GUIDE</span>
                        </div>
                        <div class="guide-content" id="ldGuideContent">
                            <div class="guide-section">
                                <span class="guide-section-icon">üéØ</span>
                                <span class="guide-section-title">WHAT'S HAPPENING</span>
                                <p class="guide-text" id="ldGuideHappening">Analyzing order flow...</p>
                            </div>
                            <div class="guide-section">
                                <span class="guide-section-icon">‚ö°</span>
                                <span class="guide-section-title">WHAT TO DO</span>
                                <p class="guide-text" id="ldGuideTodo">Calculating...</p>
                            </div>
                            <div class="guide-section">
                                <span class="guide-section-icon">üìç</span>
                                <span class="guide-section-title">KEY FLOW ZONES</span>
                                <p class="guide-text" id="ldGuideZones">Loading levels...</p>
                            </div>
                            <div class="guide-section newbie-section">
                                <span class="guide-section-icon">üü¢</span>
                                <span class="guide-section-title">NEWBIE TAKEAWAY</span>
                                <p class="guide-text newbie-text" id="ldGuideNewbie">"Waiting for data..."</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- OBIC - Order Book Imbalance Curve -->
                    <div class="pressure-row obic-row">
                        <div class="pressure-label">
                            <span class="pressure-name">OBIC
                                <span class="info-icon">?
                                    <span class="info-tooltip">
                                        <strong>Order Book Imbalance Curve</strong>
                                        Shows cumulative imbalance at each price level.<br><br>
                                        <span class="tip-bullish">Green area = Support strength</span><br>
                                        <span class="tip-bearish">Red area = Resistance strength</span><br>
                                        Spikes show where big walls exist.<br>
                                        Price tends to move toward balanced areas.
                                    </span>
                                </span>
                            </span>
                            <span class="pressure-hint">Imbalance Curve</span>
                        </div>
                    </div>
                    <div class="obic-chart-container">
                        <canvas id="obicCanvas" class="obic-canvas"></canvas>
                        <div class="obic-labels">
                            <span class="obic-label support">Support</span>
                            <span class="obic-label mid">Mid</span>
                            <span class="obic-label resistance">Resistance</span>
                        </div>
                    </div>
                    <div class="indicator-analysis" id="obicAnalysis">Imbalance profile loading...</div>
                    </div>
                </div>

                <!-- Whale Flow Tape Panel - Large Trade Detection -->
                <div class="panel whale-flow-panel collapsible expanded" data-panel="whale-flow" id="whaleFlowPanel">
                    <div class="panel-header">
                        <h3>Whale Flow
                            <span class="info-icon">?
                                <span class="info-tooltip">
                                    <strong>Large Trade Detector</strong>
                                    Tracks significant trades from "whales" (big players).<br><br>
                                    <span class="tip-bullish">üü¢ BUY = Large buyers accumulating</span><br>
                                    <span class="tip-bearish">üî¥ SELL = Large sellers distributing</span><br><br>
                                    <strong>CVD:</strong> Cumulative Volume Delta<br>
                                    Positive = More buying, Negative = More selling<br><br>
                                    <strong>Smart Money Alert:</strong> Whales trading against retail!
                                </span>
                            </span>
                        </h3>
                        <div class="panel-header-actions">
                            <span class="panel-badge live" id="whaleFlowStatus">Live</span>
                            <button class="panel-alert-btn" data-alert-section="whaleflow" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <!-- Threshold Selector -->
                        <div class="whale-threshold-selector" id="whaleThresholdSelector">
                            <span class="threshold-label">Min Size:</span>
                            <input type="number" class="threshold-input" id="whaleThreshold" title="Enter minimum trade size" step="0.01" min="0" placeholder="0.5">
                            <span class="threshold-unit" id="whaleThresholdUnit">BTC</span>
                        </div>
                        
                        <!-- CVD Summary Bar -->
                        <div class="whale-cvd-bar">
                            <div class="cvd-label">CVD (5m)</div>
                            <div class="cvd-gauge">
                                <div class="cvd-gauge-fill buy" id="whaleCvdBuy" style="width:50%"></div>
                                <div class="cvd-gauge-fill sell" id="whaleCvdSell" style="width:50%"></div>
                            </div>
                            <div class="cvd-value positive" id="whaleCvdValue">0.00</div>
                        </div>
                        
                        <!-- Live Trade Tape -->
                        <div class="whale-tape" id="whaleTape">
                            <div class="whale-tape-empty">
                                <span class="empty-icon">üêã</span>
                                <span class="empty-text">Waiting for large trades...</span>
                                <span class="empty-hint">Threshold: based on mode</span>
                            </div>
                        </div>
                        
                        <!-- Summary Row -->
                        <div class="whale-summary" id="whaleSummary">
                            <div class="whale-dominant">
                                <span class="dominant-label">Flow:</span>
                                <span class="dominant-side neutral" id="whaleDominantSide">MIXED</span>
                                <span class="dominant-pct" id="whaleDominantPct"></span>
                            </div>
                            <div class="whale-alert" id="whaleAlert"></div>
                        </div>
                    </div>
                </div>

                <!-- Price Forecast Panel (moved from right sidebar) -->
                <div class="panel direction-panel collapsible expanded" data-panel="forecast">
                    <div class="panel-header">
                        <h3>Price Forecast</h3>
                        <div class="panel-header-actions">
                            <span class="panel-badge" id="forecastStatus">Live</span>
                            <button class="panel-alert-btn" data-alert-section="forecast" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                    <!-- 3 Timeframe Forecasts -->
                    <div class="forecast-grid">
                        <!-- SHORT TERM (¬±5%) -->
                        <div class="forecast-card" id="forecastShort">
                            <div class="forecast-header">
                                <span class="forecast-label">SHORT</span>
                                <span class="forecast-range">¬±5%</span>
                                <span class="forecast-arrow neutral" id="shortArrow">‚Üí</span>
                            </div>
                            <div class="forecast-levels">
                                <div class="forecast-level resistance">
                                    <span class="level-icon">‚ñº</span>
                                    <span class="level-price" id="shortResPrice">$--</span>
                                    <span class="level-vol" id="shortResVol">--</span>
                                </div>
                                <div class="forecast-level support">
                                    <span class="level-icon">‚ñ≤</span>
                                    <span class="level-price" id="shortSupPrice">$--</span>
                                    <span class="level-vol" id="shortSupVol">--</span>
                                </div>
                            </div>
                            <div class="forecast-gauge">
                                <div class="mini-gauge">
                                    <div class="mini-gauge-fill bid" id="shortGaugeBid" style="width: 50%"></div>
                                    <div class="mini-gauge-fill ask" id="shortGaugeAsk" style="width: 50%"></div>
                                </div>
                                <span class="mini-gauge-value" id="shortGaugeValue">--</span>
                            </div>
                        </div>
                        
                        <!-- MEDIUM TERM (¬±15%) -->
                        <div class="forecast-card" id="forecastMedium">
                            <div class="forecast-header">
                                <span class="forecast-label">MEDIUM</span>
                                <span class="forecast-range">¬±15%</span>
                                <span class="forecast-arrow neutral" id="mediumArrow">‚Üí</span>
                            </div>
                            <div class="forecast-levels">
                                <div class="forecast-level resistance">
                                    <span class="level-icon">‚ñº</span>
                                    <span class="level-price" id="mediumResPrice">$--</span>
                                    <span class="level-vol" id="mediumResVol">--</span>
                                </div>
                                <div class="forecast-level support">
                                    <span class="level-icon">‚ñ≤</span>
                                    <span class="level-price" id="mediumSupPrice">$--</span>
                                    <span class="level-vol" id="mediumSupVol">--</span>
                                </div>
                            </div>
                            <div class="forecast-gauge">
                                <div class="mini-gauge">
                                    <div class="mini-gauge-fill bid" id="mediumGaugeBid" style="width: 50%"></div>
                                    <div class="mini-gauge-fill ask" id="mediumGaugeAsk" style="width: 50%"></div>
                                </div>
                                <span class="mini-gauge-value" id="mediumGaugeValue">--</span>
                            </div>
                        </div>
                        
                        <!-- LONG TERM (¬±30%) -->
                        <div class="forecast-card" id="forecastLong">
                            <div class="forecast-header">
                                <span class="forecast-label">LONG</span>
                                <span class="forecast-range">¬±30%</span>
                                <span class="forecast-arrow neutral" id="longArrow">‚Üí</span>
                            </div>
                            <div class="forecast-levels">
                                <div class="forecast-level resistance">
                                    <span class="level-icon">‚ñº</span>
                                    <span class="level-price" id="longResPrice">$--</span>
                                    <span class="level-vol" id="longResVol">--</span>
                                </div>
                                <div class="forecast-level support">
                                    <span class="level-icon">‚ñ≤</span>
                                    <span class="level-price" id="longSupPrice">$--</span>
                                    <span class="level-vol" id="longSupVol">--</span>
                                </div>
                            </div>
                            <div class="forecast-gauge">
                                <div class="mini-gauge">
                                    <div class="mini-gauge-fill bid" id="longGaugeBid" style="width: 50%"></div>
                                    <div class="mini-gauge-fill ask" id="longGaugeAsk" style="width: 50%"></div>
                                </div>
                                <span class="mini-gauge-value" id="longGaugeValue">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Overall Summary -->
                    <div class="forecast-summary">
                        <div class="summary-item">
                            <span class="summary-label">Overall Bias</span>
                            <span class="summary-value" id="overallBias">--</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Confidence</span>
                            <span class="summary-value" id="overallConfidence">--</span>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Fair Value Panel -->
                <div class="panel fair-value-panel collapsible expanded" data-panel="fairvalue">
                    <div class="panel-header">
                        <h3>Fair Value</h3>
                        <div class="panel-header-actions">
                            <span class="panel-badge" id="fvStatus">Live</span>
                            <button class="panel-alert-btn" data-alert-section="fairvalue" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                    <div class="fv-metrics">
                        <div class="fv-row">
                            <span class="fv-label">Current</span>
                            <span class="fv-value" id="fvCurrentPrice">$--</span>
                        </div>
                        <div class="fv-row">
                            <span class="fv-label">Mid</span>
                            <span class="fv-value" id="fvMidValue">$--</span>
                            <span class="fv-diff" id="fvMidDiff">--</span>
                        </div>
                        <div class="fv-row">
                            <span class="fv-label">VWMP</span>
                            <span class="fv-value" id="fvVwmpValue">$--</span>
                            <span class="fv-diff" id="fvVwmpDiff">--</span>
                        </div>
                        <div class="fv-row">
                            <span class="fv-label">IFV</span>
                            <span class="fv-value" id="fvIfvValue">$--</span>
                            <span class="fv-diff" id="fvIfvDiff">--</span>
                        </div>
                    </div>
                    
                    <div class="fv-analysis" id="fvAnalysis">
                        <div class="fv-analysis-text" id="fvAnalysisText">Calculating fair values...</div>
                    </div>
                    
                    </div>
                </div>
                
                <!-- Trade Setup Panel -->
                <div class="panel trade-setup-panel collapsible expanded" data-panel="trade-setup" id="tradeSetupPanel">
                    <div class="panel-header">
                        <h3>Trade Setup</h3>
                        <div class="panel-header-actions">
                            <span class="panel-badge" id="tradeStatus">Live</span>
                            <button class="panel-alert-btn" data-alert-section="tradesetup" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <!-- Recommended Signal - Hero -->
                        <div class="ts-signal">
                            <div class="ts-rec">
                                <span class="ts-rec-label">Recommended</span>
                                <span class="ts-rec-value wait" id="recommendedDirection">WAIT</span>
                            </div>
                            <div class="ts-controls">
                                <button class="ts-btn long" id="positionLong" title="Go Long">‚ñ≤ LONG</button>
                                <button class="ts-btn short" id="positionShort" title="Go Short">‚ñº SHORT</button>
                            </div>
                        </div>
                        
                        <!-- Min Gain Filter -->
                        <div class="ts-filter">
                            <span class="ts-filter-label">Min %</span>
                            <input type="number" id="minGainPercent" value="1" min="0.1" max="20" step="0.1">
                            <label class="ts-chart-toggle">
                                <input type="checkbox" id="showTradeOnChart">
                                <span>Chart</span>
                            </label>
                        </div>
                        
                        <!-- Levels Grid -->
                        <div class="ts-levels">
                            <div class="ts-level entry"><span>Entry</span><span id="tradeEntry">$--</span></div>
                            <div class="ts-level stop"><span>Stop</span><span id="tradeStop">$--</span></div>
                            <div class="ts-level tp1"><span>TP1</span><span id="tradeTarget1">$--</span></div>
                            <div class="ts-level tp2"><span>TP2</span><span id="tradeTarget2">$--</span></div>
                        </div>
                        
                        <!-- R:R Display -->
                        <div class="ts-rr">
                            <span>R:R</span>
                            <span class="ts-rr-value" id="tradeRR">--</span>
                        </div>
                        
                        <!-- Reasoning -->
                        <div class="ts-reasoning" id="tradeReasoning">
                            Select LONG or SHORT to see trade setup.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar - Alpha, Regime & Levels -->
            <div class="sidebar sidebar-right" id="sidebarRight">
                <div class="sidebar-handle" id="collapseRightSidebar" title="Click to collapse/expand">
                    <span class="handle-bars">||</span>
                </div>
                
                <!-- Alpha Strike Signal Panel - Pure Alpha Direction -->
                <div class="panel alpha-strike-panel collapsible expanded" data-panel="alpha-strike" id="alphaStrikePanel">
                    <div class="panel-header alpha-strike-header">
                        <div class="panel-header-top">
                            <h3>Alpha Strike</h3>
                            <span class="panel-badge live">Live</span>
                            <button class="panel-alert-btn" data-alert-section="alphastrike" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div class="strike-mode-selector" id="strikeModeSelector">
                            <button class="strike-mode-btn" data-mode="mm" title="Market Maker: Fast signals, 3/5 confluence">
                                <span class="mode-icon">‚ö°</span>
                                <span class="mode-label">MM</span>
                            </button>
                            <button class="strike-mode-btn" data-mode="swing" title="Swing: Balanced, 4/5 confluence">
                                <span class="mode-icon">üìä</span>
                                <span class="mode-label">Swing</span>
                            </button>
                            <button class="strike-mode-btn active" data-mode="htf" title="HTF: Conservative, 5/5 confluence">
                                <span class="mode-icon">üè¶</span>
                                <span class="mode-label">HTF</span>
                            </button>
                        </div>
                        <!-- Hero Signal -->
                        <div class="as-hero" id="strikeDirection">
                            <div class="as-signal neutral" id="strikeArrow">
                                <span class="as-arrow">‚Äï</span>
                                <span class="as-label" id="strikeLabel">FLAT</span>
                            </div>
                            <div class="as-stats">
                                <div class="as-stat">
                                    <span class="as-stat-val" id="strikeStrength">0%</span>
                                    <div class="as-bar"><div class="as-bar-fill" id="strikeMeterFill"></div></div>
                                </div>
                                <div class="as-action">
                                    <span class="as-badge wait" id="strikeActionBadge">WAIT</span>
                                    <span class="as-timer" id="strikeCountdown"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Confluence Grid -->
                        <div class="as-confluence" id="strikeConfluence">
                            <div class="as-conf-head">
                                <span>Confluence</span>
                                <span class="as-conf-score" id="confluenceScore">0/5</span>
                            </div>
                            <div class="as-conf-grid">
                                <div class="as-conf" data-indicator="mcs"><span class="as-conf-dot"></span><span class="as-conf-id">MCS</span><span class="as-conf-val">‚Äî</span></div>
                                <div class="as-conf" data-indicator="alpha"><span class="as-conf-dot"></span><span class="as-conf-id">Alpha</span><span class="as-conf-val">‚Äî</span></div>
                                <div class="as-conf" data-indicator="ld"><span class="as-conf-dot"></span><span class="as-conf-id">LD</span><span class="as-conf-val">‚Äî</span></div>
                                <div class="as-conf" data-indicator="bbp"><span class="as-conf-dot"></span><span class="as-conf-id">BBP</span><span class="as-conf-val">‚Äî</span></div>
                                <div class="as-conf" data-indicator="forecast"><span class="as-conf-dot"></span><span class="as-conf-id">FC</span><span class="as-conf-val">‚Äî</span></div>
                            </div>
                        </div>
                        
                        <!-- Insight -->
                        <div class="as-insight" id="strikeNewbie">
                            <span class="as-insight-text" id="strikeNewbieText">Waiting for confluence...</span>
                        </div>
                    </div>
                </div>

                <!-- Market Consensus Signal Panel -->
                <div class="panel mcs-panel collapsible expanded" data-panel="mcs" id="mcsPanel">
                    <!-- Trend Color Stripe (Enhancement #5) -->
                    <div class="mcs-stripe" id="mcsStripe">
                        <div class="stripe-segment neutral"></div>
                        <div class="stripe-segment neutral"></div>
                        <div class="stripe-segment neutral"></div>
                    </div>
                    
                    <div class="panel-header">
                        <h3>Market Consensus</h3>
                        <div class="panel-header-actions">
                            <span class="panel-badge">Live</span>
                            <button class="panel-alert-btn" data-alert-section="mcs" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="mcs-mode-row">
                        <div class="mcs-mode-selector" id="mcsModeSelector">
                            <button class="mode-btn" data-mode="aggressive" title="Aggressive: Heavy MM weight">
                                <span class="mode-icon">‚ö°</span>
                                <span class="mode-label">AGG</span>
                            </button>
                            <button class="mode-btn" data-mode="balanced" title="Balanced: Default weighting">
                                <span class="mode-icon">‚öñÔ∏è</span>
                                <span class="mode-label">BAL</span>
                            </button>
                            <button class="mode-btn active" data-mode="conservative" title="Conservative: All TFs align">
                                <span class="mode-icon">üõ°Ô∏è</span>
                                <span class="mode-label">CON</span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <!-- MCS Header with main signal + confidence + dots -->
                        <div class="mcs-header" id="mcsHeader">
                            <div class="mcs-main-signal neutral">
                                <span class="mcs-icon">üü°</span>
                                <span class="mcs-label">LOADING...</span>
                                <span class="mcs-score">(--/100)</span>
                            </div>
                        </div>
                        
                        <!-- Quant Summary (Enhancement #3) -->
                        <div class="mcs-quant-summary" id="mcsQuant">
                            <div class="quant-row"><span class="quant-label">Loading...</span></div>
                        </div>
                        
                        <!-- MM Row -->
                        <div class="mcs-row" id="mcsMM">
                            <div class="mcs-row-header">
                                <span class="mcs-row-title">‚ö° MM (Microstructure)</span>
                                <span class="mcs-row-bias">--</span>
                            </div>
                            <div class="mcs-row-details">Loading...</div>
                        </div>
                        
                        <!-- Swing Row -->
                        <div class="mcs-row" id="mcsSwing">
                            <div class="mcs-row-header">
                                <span class="mcs-row-title">üìä Swing (Short-term)</span>
                                <span class="mcs-row-bias">--</span>
                            </div>
                            <div class="mcs-row-details">Loading...</div>
                        </div>
                        
                        <!-- HTF Row -->
                        <div class="mcs-row" id="mcsHTF">
                            <div class="mcs-row-header">
                                <span class="mcs-row-title">üè¶ HTF (Macro)</span>
                                <span class="mcs-row-bias">--</span>
                            </div>
                            <div class="mcs-row-details">Loading...</div>
                        </div>
                        
                        <!-- Trade Plan -->
                        <div class="mcs-trade-plan" id="mcsTradePlan">
                            <div class="trade-plan-header">
                                <span class="trade-plan-action neutral">üü° CALCULATING...</span>
                            </div>
                        </div>
                        
                        <!-- Newbie Takeaway -->
                        <div class="mcs-newbie" id="mcsNewbie">
                            <span class="mcs-newbie-icon">üí°</span>
                            <span class="mcs-newbie-text">"Waiting for data..."</span>
                        </div>
                    </div>
                </div>

                <!-- Alpha Score Panel (moved from left sidebar) -->
                <div class="panel alpha-score-panel collapsible expanded" data-panel="alpha">
                    <div class="panel-header">
                        <h3>Alpha Score</h3>
                        <div class="panel-header-actions">
                            <span class="alpha-badge" id="alphaRegime">--</span>
                            <button class="panel-alert-btn" data-alert-section="alpha" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div class="regime-mode-selector alpha-mode-selector">
                            <button class="regime-mode-btn alpha-mode-btn" data-alpha-mode="marketMaker" title="Very sensitive - rapid alpha shifts for scalping">
                                <span class="mode-icon">‚ö°</span>
                                <span class="mode-label">MM</span>
                            </button>
                            <button class="regime-mode-btn alpha-mode-btn" data-alpha-mode="swingTrader" title="Moderate sensitivity - smoother alpha for swing trading">
                                <span class="mode-icon">üìä</span>
                                <span class="mode-label">Swing</span>
                            </button>
                            <button class="regime-mode-btn alpha-mode-btn active" data-alpha-mode="investor" title="Low sensitivity - HTF alpha for position trading">
                                <span class="mode-icon">üè¶</span>
                                <span class="mode-label">HTF</span>
                            </button>
                        </div>
                        <div class="alpha-sensitivity-slider">
                            <span class="slider-label left" title="Slower response">üê¢</span>
                            <div class="slider-container">
                                <input type="range" id="alphaSensitivity" min="0" max="100" value="50" step="1" title="Sensitivity multiplier on top of mode defaults">
                                <div class="slider-notch"></div>
                            </div>
                            <span class="slider-label right" title="Faster response">‚ö°</span>
                            <span class="slider-value" id="alphaSensitivityValue">1.0x</span>
                            <span class="slider-warning" id="alphaSensitivityWarning" title="Ultra-slow: May not respond to rapid market changes">‚ö†Ô∏è</span>
                        </div>
                    <div class="alpha-score-display">
                        <div class="alpha-gauge">
                            <div class="alpha-gauge-track">
                                <div class="alpha-gauge-fill" id="alphaGaugeFill"></div>
                                <div class="alpha-gauge-zones">
                                    <span class="zone bearish">BEAR</span>
                                    <span class="zone neutral">NEUTRAL</span>
                                    <span class="zone bullish">BULL</span>
                                </div>
                            </div>
                            <div class="alpha-gauge-marker" id="alphaGaugeMarker"></div>
                        </div>
                        <div class="alpha-value-display">
                            <span class="alpha-value" id="alphaValue">--</span>
                            <span class="alpha-label">/ 100</span>
                        </div>
                    </div>
                    <div class="alpha-components">
                        <div class="alpha-component">
                            <span class="comp-name">LD</span>
                            <div class="comp-bar"><div class="comp-fill" id="alphaLdFill"></div></div>
                            <span class="comp-weight">40%</span>
                        </div>
                        <div class="alpha-component">
                            <span class="comp-name">BPR</span>
                            <div class="comp-bar"><div class="comp-fill" id="alphaBprFill"></div></div>
                            <span class="comp-weight">25%</span>
                        </div>
                        <div class="alpha-component">
                            <span class="comp-name">IFV</span>
                            <div class="comp-bar"><div class="comp-fill" id="alphaIfvFill"></div></div>
                            <span class="comp-weight">25%</span>
                        </div>
                        <div class="alpha-component">
                            <span class="comp-name">VWMP</span>
                            <div class="comp-bar"><div class="comp-fill" id="alphaVwmpFill"></div></div>
                            <span class="comp-weight">10%</span>
                        </div>
                    </div>
                    <div class="alpha-interpretation" id="alphaInterpretation">
                        Calculating microstructure alpha...
                    </div>
                    
                    <!-- Alpha Newbie Summary - Easy to understand trading advice -->
                    <div class="alpha-newbie-summary" id="alphaNewbieSummary">
                        <!-- Populated dynamically with actionable advice -->
                    </div>
                    </div>
                </div>

                <!-- Regime Engine Panel -->
                <div class="panel regime-panel collapsible expanded" data-panel="regime">
                    <div class="panel-header">
                        <h3>Regime Engine</h3>
                        <div class="panel-header-actions">
                            <span class="panel-badge live" id="regimeStatus">Live</span>
                            <button class="panel-alert-btn" data-alert-section="regime" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                    
                    <!-- Regime Mode Selector -->
                    <div class="regime-mode-selector">
                        <button class="regime-mode-btn" data-mode="marketMaker" title="Very sensitive - rapid regime changes for scalping">
                            <span class="mode-icon">‚ö°</span>
                            <span class="mode-label">MM</span>
                        </button>
                        <button class="regime-mode-btn" data-mode="swingTrader" title="Moderate sensitivity - smoother transitions for swing trading">
                            <span class="mode-icon">üìä</span>
                            <span class="mode-label">Swing</span>
                        </button>
                        <button class="regime-mode-btn active" data-mode="investor" title="Low sensitivity - only major structural shifts for position trading">
                            <span class="mode-icon">üè¶</span>
                            <span class="mode-label">HTF</span>
                        </button>
                    </div>
                    
                    <!-- Current Regime Display -->
                    <div class="regime-current" id="regimeCurrent">
                        <span class="regime-icon" id="regimeIcon">‚è≥</span>
                        <span class="regime-name" id="regimeName">Analyzing...</span>
                    </div>
                    <div class="regime-description" id="regimeDescription">
                        Waiting for data to classify market regime...
                    </div>
                    
                    <!-- Momentum Signals Section -->
                    <div class="regime-section">
                        <div class="regime-section-header">
                            <span class="section-title">MOMENTUM</span>
                            <span class="info-icon" data-tooltip="Rate of change signals showing how fast pressure is shifting">‚ìò</span>
                        </div>
                        <div class="regime-row">
                            <span class="regime-label">LD_ROC</span>
                            <div class="regime-mini-gauge">
                                <div class="mini-bar-container">
                                    <div class="mini-bar-fill negative" id="ldRocBarNeg" style="width: 0%"></div>
                                    <div class="mini-bar-center"></div>
                                    <div class="mini-bar-fill positive" id="ldRocBarPos" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="regime-value" id="ldRocValue">--</span>
                        </div>
                        <div class="regime-row">
                            <span class="regime-label">BPR_ROC</span>
                            <div class="regime-mini-gauge">
                                <div class="mini-bar-container">
                                    <div class="mini-bar-fill negative" id="bprRocBarNeg" style="width: 0%"></div>
                                    <div class="mini-bar-center"></div>
                                    <div class="mini-bar-fill positive" id="bprRocBarPos" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="regime-value" id="bprRocValue">--</span>
                        </div>
                        <div class="regime-row">
                            <span class="regime-label">Alpha_ROC</span>
                            <div class="regime-mini-gauge">
                                <div class="mini-bar-container">
                                    <div class="mini-bar-fill negative" id="alphaRocBarNeg" style="width: 0%"></div>
                                    <div class="mini-bar-center"></div>
                                    <div class="mini-bar-fill positive" id="alphaRocBarPos" style="width: 0%"></div>
                                </div>
                            </div>
                            <span class="regime-value" id="alphaRocValue">--</span>
                        </div>
                    </div>
                    
                    <!-- Extension Section -->
                    <div class="regime-section">
                        <div class="regime-section-header">
                            <span class="section-title">EXTENSION</span>
                            <span class="info-icon" data-tooltip="How far price is stretched from fair value ‚Äî positive = premium, negative = discount">‚ìò</span>
                        </div>
                        <div class="regime-row">
                            <span class="regime-label">VWMP_ext</span>
                            <span class="regime-value ext" id="vwmpExtValue">--</span>
                            <span class="regime-hint" id="vwmpExtHint">--</span>
                        </div>
                        <div class="regime-row">
                            <span class="regime-label">IFV_ext</span>
                            <span class="regime-value ext" id="ifvExtValue">--</span>
                            <span class="regime-hint" id="ifvExtHint">--</span>
                        </div>
                    </div>
                    
                    <!-- Liquidity Structure Section -->
                    <div class="regime-section">
                        <div class="regime-section-header">
                            <span class="section-title">LIQUIDITY STRUCTURE</span>
                            <span class="info-icon" data-tooltip="Shows where big orders are clustered and potential price vacuums">‚ìò</span>
                        </div>
                        <div class="regime-row gap-row">
                            <div class="gap-item">
                                <span class="gap-label">Support Gap</span>
                                <span class="gap-value" id="supportGapValue">--</span>
                            </div>
                            <div class="gap-item">
                                <span class="gap-label">Resist Gap</span>
                                <span class="gap-value" id="resistGapValue">--</span>
                            </div>
                        </div>
                        <div class="regime-row share-row">
                            <span class="regime-label">Volume Share</span>
                            <div class="share-gauge">
                                <div class="share-bar support" id="supportShareBar" style="width: 50%">
                                    <span class="share-label" id="supportShareLabel">50%</span>
                                </div>
                                <div class="share-bar resistance" id="resistShareBar" style="width: 50%">
                                    <span class="share-label" id="resistShareLabel">50%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Regime Interpretation -->
                    <div class="regime-interpretation" id="regimeInterpretation">
                        <span class="interpretation-text">Collecting signals for regime classification...</span>
                    </div>
                    
                    <!-- Newbie Summary - Easy to understand trading advice -->
                    <div class="regime-newbie-summary" id="regimeNewbieSummary">
                        <!-- Populated dynamically with actionable advice -->
                    </div>
                    
                    <!-- Regime Transition Probability -->
                    <div class="regime-transition-section">
                        <div class="transition-header">
                            <span class="transition-title">üìä Next Regime Probability</span>
                        </div>
                        <div class="regime-transition-probs" id="regimeTransitionProbs">
                            <div class="transition-loading">Calculating transition probabilities...</div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Levels Panel (collapsed by default to prevent scroll issues) -->
                <div class="panel levels-panel collapsible" data-panel="levels">
                    <div class="panel-header">
                        <h3>Key Levels</h3>
                        <div class="panel-header-actions">
                            <div class="level-filter">
                                <button class="filter-btn active" data-filter="all">All</button>
                                <button class="filter-btn" data-filter="support">Bids</button>
                                <button class="filter-btn" data-filter="resistance">Asks</button>
                            </div>
                            <button class="panel-alert-btn" data-alert-section="levels" title="Create alert">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7"/>
                                    <path d="M13.73 21a2 2 0 01-3.46 0"/>
                                </svg>
                                <span class="panel-alert-count" data-alert-count="0" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div class="levels-list" id="levelsList">
                            <div class="loading">Loading levels...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-status">
                <span class="data-source-indicator disconnected" id="dataSourceIndicator" title="Data source">
                    <span class="source-dot"></span>
                    <span class="source-label">...</span>
                </span>
                <span class="cache-status" id="cacheStatus">--</span>
                <span class="footer-update" id="lastUpdate">--</span>
            </div>
            <div class="footer-info">
                <span class="footer-copyright">¬© 2025 <a href="mailto:daniel.boorn@gmail.com">Daniel Boorn</a></span>
                <span class="footer-sep">¬∑</span>
                <span class="footer-disclaimer" title="Educational use only ¬∑ Not financial advice ¬∑ Crypto trading involves substantial risk ¬∑ Personal non-commercial use only ¬∑ Contact daniel.boorn@gmail.com for commercial licensing">Not Financial Advice. Trading has Risks. Use at Own Risk.</span>
                <span class="footer-sep">¬∑</span>
                <span class="footer-version">v20251217.2</span>
            </div>
            <div class="footer-links">
                <a href="analysis.html" class="footer-link" title="Analysis Dashboard">
                    <svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1v14h14V1H1zm13 13H2V2h12v12zM4 10h2v3H4v-3zm3-3h2v6H7V7zm3-3h2v9h-2V4z"/></svg>
                </a>
                <a href="https://github.com/deboorn/synthetic-order-book/" target="_blank" rel="noopener" class="footer-link" title="GitHub">
                    <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                </a>
                <a href="https://www.tradingview.com/free-charting-libraries/" target="_blank" rel="noopener" class="footer-link footer-link-tv" title="Charts by TradingView">
                    <img src="img/black-logo.svg" alt="TV">
                </a>
            </div>
        </footer>
    </div>

    <!-- Legend Modal -->
    <div class="modal" id="legendModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content legend-modal-wide">
            <div class="modal-header">
                <h2>üìä Chart Legend & Feature Guide</h2>
                <button class="modal-close" id="closeLegend">&times;</button>
            </div>
            <div class="modal-body legend-grid">
                <!-- Column 1 -->
                <div class="legend-column">
                <div class="legend-section">
                        <h3>üéØ Order Book Levels</h3>
                    <div class="legend-item">
                        <span class="legend-line support"></span>
                        <div>
                            <strong>Support (Green)</strong>
                                <p>Aggregated buy orders from multi-exchange order books. Line thickness = relative volume strength.</p>
                        </div>
                    </div>
                    <div class="legend-item">
                        <span class="legend-line resistance"></span>
                        <div>
                            <strong>Resistance (Red)</strong>
                                <p>Aggregated sell orders. Shows where sellers are stacking asks.</p>
                        </div>
                    </div>
                        <div class="legend-note">
                            Labels: <code>‚ñ≤/‚ñº [Vol] BTC @ [Price]</code>
                </div>
                    </div>

                <div class="legend-section">
                        <h3>üìà Fair Value Lines</h3>
                        <div class="legend-item">
                            <span class="legend-swatch" style="background: #f59e0b;"></span>
                            <div>
                                <strong>Mid Price</strong>
                                <p>Midpoint between best bid/ask. True market equilibrium.</p>
                </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-swatch" style="background: #06b6d4;"></span>
                            <div>
                                <strong>IFV (Imbalance Fair Value)</strong>
                                <p>Weighted by order book imbalance. Skews toward dominant side.</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-swatch" style="background: #a855f7;"></span>
                            <div>
                                <strong>VWMP (Volume-Weighted Mid)</strong>
                                <p>Fair value weighted by depth volume distribution.</p>
                            </div>
                        </div>
                    </div>

                <div class="legend-section">
                        <h3>üéØ Trade Setup</h3>
                        <div class="legend-item">
                            <span class="legend-swatch" style="background: #eab308;"></span>
                            <div>
                                <strong>Entry (Yellow)</strong>
                                <p>Optimal entry price calculated from order flow analysis.</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-swatch" style="background: #ef4444;"></span>
                            <div>
                                <strong>Stop Loss (Red)</strong>
                                <p>Suggested stop based on support/resistance structure.</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-swatch" style="background: #22c55e;"></span>
                            <div>
                                <strong>Targets (Green)</strong>
                                <p>T1/T2 profit targets with projected rays.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Column 2 -->
                <div class="legend-column">
                    <div class="legend-section">
                        <h3>üìê EMA & ZEMA Grids</h3>
                        <div class="legend-item">
                            <span class="legend-swatch" style="background: #9ca3af;"></span>
                            <div>
                                <strong>EMA Grid (Gray)</strong>
                                <p>Exponential Moving Average with percentage-spaced grid lines. Default: 20 period, 0.5% spacing.</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-swatch" style="background: #8b5cf6;"></span>
                            <div>
                                <strong>ZEMA Grid (Purple)</strong>
                                <p>Zero-lag EMA reduces lag via double-smoothing: <code>2√óEMA - EMA(EMA)</code>. Default: 30 period, 0.3% spacing.</p>
                            </div>
                        </div>
                        <div class="legend-note">
                            <strong>Grid Signals:</strong> ‚¨ÜÔ∏è when low touches bottom grid, ‚¨áÔ∏è when high touches top grid.
                        </div>
                    </div>

                    <div class="legend-section">
                        <h3>‚ö° BB Pulse Lighting Signals</h3>
                        <div class="legend-item">
                            <span class="legend-arrow up">‚ñ≤</span>
                            <div>
                                <strong>Bullish Lightning (Green Arrow)</strong>
                                <p>BB%B crosses above upper threshold during expansion. High-probability long signal.</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-arrow down">‚ñº</span>
                            <div>
                                <strong>Bearish Lightning (Red Arrow)</strong>
                                <p>BB%B crosses below lower threshold during expansion. High-probability short signal.</p>
                            </div>
                        </div>
                        <div class="legend-note">
                            Based on Bollinger Band Width expansion + %B positioning for momentum trades.
                        </div>
                    </div>

                    <div class="legend-section">
                        <h3>üè∑Ô∏è LD Flow Zones</h3>
                        <div class="legend-item">
                            <span class="legend-badge support-badge">SUPPORT</span>
                            <div>
                                <strong>Support Zone</strong>
                                <p>Price level where buying pressure dominates based on Liquidity Delta analysis.</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-badge resistance-badge">RESIST</span>
                            <div>
                                <strong>Resistance Zone</strong>
                                <p>Price level where selling pressure dominates.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Column 3 -->
                <div class="legend-column">
                    <div class="legend-section">
                        <h3>üìä Order Flow Metrics</h3>
                        <div class="legend-item">
                            <span class="legend-metric">LD</span>
                            <div>
                                <strong>Liquidity Delta</strong>
                                <p>Bid vs Ask volume imbalance. Positive = more bids (bullish), Negative = more asks (bearish).</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-metric">BPR</span>
                            <div>
                                <strong>Buy Pressure Ratio</strong>
                                <p>Percentage of bid volume vs total. >50% = buy pressure dominant.</p>
                            </div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-metric">Œ±</span>
                            <div>
                                <strong>Alpha Score (0-100)</strong>
                                <p>Composite strength indicator. üü¢ 70+ Bullish, üü° 30-70 Neutral, üî¥ &lt;30 Bearish.</p>
                            </div>
                        </div>
                    </div>

                    <div class="legend-section">
                        <h3>üß† Regime Engine</h3>
                        <p class="legend-intro">Detects market state using ROC (Rate of Change) analysis:</p>
                        <div class="legend-item compact">
                            <span class="legend-regime bullish">‚ñ≤ BULLISH</span>
                            <span>Upward momentum detected</span>
                        </div>
                        <div class="legend-item compact">
                            <span class="legend-regime bearish">‚ñº BEARISH</span>
                            <span>Downward momentum detected</span>
                        </div>
                        <div class="legend-item compact">
                            <span class="legend-regime neutral">‚óÜ RANGING</span>
                            <span>Sideways/consolidation</span>
                        </div>
                        <div class="legend-note">
                            <strong>Modes:</strong> Market Maker (fast), Swing (medium), HTF/Investor (slow, smoothed).
                        </div>
                    </div>

                    <div class="legend-section">
                        <h3>üéØ Market Consensus (MCS)</h3>
                        <p>Weighted combination of all regime modes:</p>
                        <div class="legend-note">
                            <strong>MM:</strong> 50% Market Maker weight<br>
                            <strong>Swing:</strong> 33% Swing + 33% MM + 33% HTF<br>
                            <strong>HTF:</strong> 50% HTF/Investor weight
                        </div>
                        <p style="margin-top: 4px; font-size: 0.7em; opacity: 0.7;">MCS provides the final directional bias shown in header.</p>
                    </div>

                    <div class="legend-section">
                        <h3>üì° Data Sources</h3>
                        <p>Real-time WebSocket feeds from <strong>Kraken</strong>, <strong>Coinbase</strong>, and <strong>Bitstamp</strong>. Order book depth aggregated and clustered into significant price zones.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal (Full Screen) -->
    <div class="modal fullscreen-modal" id="settingsModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content fullscreen-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="closeSettings">&times;</button>
            </div>
            <div class="modal-body settings-grid">
                <!-- Column 1: Chart Overlays -->
                <div class="settings-column">
                    <h3 class="settings-section-title">Chart Overlays</h3>
                    
                    <div class="settings-toggles-group">
                        <h4>Order Book</h4>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showLevels">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Support/Resistance Levels</span>
                                <span class="toggle-hint">Show order book levels on chart</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showVolume">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Volume Bars</span>
                                <span class="toggle-hint">Show volume histogram below chart</span>
                            </div>
                        </label>
                        <!-- Historical features disabled for WebSocket performance - may revisit later -->
                        <div style="display:none" aria-hidden="true">
                            <input type="checkbox" id="showHistoricalLevels">
                            <input type="checkbox" id="showHistoricalFairValue">
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showLDFlowZones" checked>
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">LD Flow Zones</span>
                                <span class="toggle-hint">Show support/resistance labels from LD analysis</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="settings-toggles-group">
                        <h4>Projections</h4>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showTargets">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Target Lines</span>
                                <span class="toggle-hint">Horizontal lines at projected targets</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showRays">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Projection Rays</span>
                                <span class="toggle-hint">Angled rays toward targets</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showConfidence">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Confidence %</span>
                                <span class="toggle-hint">Show confidence on projections</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="settings-toggles-group">
                        <h4>Technical</h4>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showEmaGrid">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">EMA Grid</span>
                                <span class="toggle-hint">Exponential Moving Average with grid</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showZemaGrid">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">ZEMA Grid</span>
                                <span class="toggle-hint">Zero-lag EMA with grid</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showEmaSignals">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">EMA Grid Signals</span>
                                <span class="toggle-hint">Arrows when price crosses EMA grid lines</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showZemaSignals">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">ZEMA Grid Signals</span>
                                <span class="toggle-hint">Arrows when price crosses ZEMA grid lines</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showBBPulse">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">DB BB Pulse Lighting Signals</span>
                                <span class="toggle-hint">Buy/sell signal arrows on chart</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showBullsBears">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Bulls vs Bears Signal</span>
                                <span class="toggle-hint">Arrow based on order book pressure above/below price</span>
                            </div>
                        </label>
                        <div class="settings-group bulls-bears-method" style="margin-left: 32px; margin-top: -4px; margin-bottom: 6px;">
                            <label>
                                <span style="font-size: 10px; color: #64748b;">Method</span>
                            </label>
                            <select id="bullsBearsMethod" class="tf-select" style="width: 120px; font-size: 10px; padding: 3px 6px;">
                                <option value="firstLevel">First Level</option>
                                <option value="percentRange">20% Range</option>
                            </select>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showTradeFootprint">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Trade Footprint Heatmap</span>
                                <span class="toggle-hint">Delta heatmap at each price level per bar</span>
                            </div>
                        </label>
                        <div class="settings-group trade-footprint-bucket" style="margin-left: 32px; margin-top: -4px; margin-bottom: 6px;">
                            <label>
                                <span style="font-size: 10px; color: #64748b;">Bucket Size</span>
                            </label>
                            <select id="tradeFootprintBucketSize" class="tf-select" style="width: 80px; font-size: 10px; padding: 3px 6px;">
                                <option value="5">$5</option>
                                <option value="10" selected>$10</option>
                                <option value="25">$25</option>
                                <option value="50">$50</option>
                                <option value="100">$100</option>
                            </select>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showLevelHistoryHeatmap" checked>
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Levels Heatmap</span>
                                <span class="toggle-hint">Order book cluster history on chart</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="settings-toggles-group">
                        <h4>Fair Value Indicators</h4>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showMid">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Simple Mid</span>
                                <span class="toggle-hint">(Best Bid + Best Ask) / 2</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showIFV">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">IFV (Implied Fair Value)</span>
                                <span class="toggle-hint">Volume-weighted strongest levels</span>
                            </div>
                        </label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="showVWMP">
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">VWMP</span>
                                <span class="toggle-hint">Volume-Weighted Mid Price</span>
                            </div>
                        </label>
                    </div>
                    
                    <div class="settings-toggles-group">
                        <h4>Analytics Data Source</h4>
                        <label class="settings-toggle">
                            <input type="checkbox" id="useFullBook" checked>
                            <span class="toggle-slider"></span>
                            <div class="toggle-info">
                                <span class="toggle-label">Use Full Order Book</span>
                                <span class="toggle-hint">Affects analytics only (VWMP/IFV always use full book)</span>
                            </div>
                        </label>
                        
                        <div class="settings-group">
                            <label>
                                <span>LD Mode</span>
                                <span class="setting-hint">Signal focuses near-price liquidity for clearer bias; Context uses broader book</span>
                            </label>
                            <div class="setting-input">
                                <select id="settingLDMode" class="tf-select">
                                    <option value="signal">Signal</option>
                                    <option value="context">Context</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-group" id="settingLDRangeGroup">
                            <label>
                                <span>LD Window %</span>
                                <span class="setting-hint">Signal mode: include levels within ¬±X% of current price</span>
                            </label>
                            <div class="setting-input">
                                <input type="range" id="settingLDRange" min="1" max="50" step="1" value="10">
                                <span class="setting-value" id="ldRangeValue">¬±10%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Column 2: Level Filtering -->
                <div class="settings-column">
                    <h3 class="settings-section-title">Level Filtering</h3>
                    
                    <div class="settings-group">
                        <label>
                            <span>Update Throttle</span>
                            <span class="setting-hint">WebSocket update frequency (lower = faster, more CPU)</span>
                        </label>
                        <div class="setting-input">
                            <input type="range" id="settingUpdateThrottle" min="100" max="2000" step="100" value="500">
                            <span class="setting-value" id="updateThrottleValue">500ms</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>Price Clustering %</span>
                            <span class="setting-hint">Group orders within this % range (0 = no clustering)</span>
                        </label>
                        <div class="setting-input">
                            <input type="number" id="settingCluster" min="0" max="20" step="0.01" value="0.15" class="number-input">
                            <span class="setting-value">%</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>Max Levels</span>
                            <span class="setting-hint">Maximum levels to display</span>
                        </label>
                        <div class="setting-input">
                            <input type="range" id="settingMaxLevels" min="10" max="500" step="10" value="500">
                            <span class="setting-value" id="maxLevelsValue">500</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>Min Volume (<span id="minVolSymbol">BTC</span>)</span>
                            <span class="setting-hint">Hide levels below this volume</span>
                        </label>
                        <div class="setting-input">
                            <input type="range" id="settingMinVol" min="0" max="100" step="5" value="15">
                            <span class="setting-value" id="minVolValue">15 BTC</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>Price Range %</span>
                            <span class="setting-hint">Show levels within ¬±X% of price</span>
                        </label>
                        <div class="setting-input">
                            <input type="range" id="settingPriceRange" min="5" max="100" step="5" value="100">
                            <span class="setting-value" id="priceRangeValue">¬±100%</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>Fair Value Range %</span>
                            <span class="setting-hint">VWMP/IFV use levels within ¬±X% of price (filters outliers)</span>
                        </label>
                        <div class="setting-input">
                            <input type="range" id="settingFairValueRange" min="5" max="50" step="5" value="15">
                            <span class="setting-value" id="fairValueRangeValue">¬±15%</span>
                        </div>
                    </div>
                    
                    <div class="settings-divider"></div>
                    <h3 class="settings-section-title">Level Appearance</h3>
                    
                    <div class="settings-group">
                        <label>
                            <span>Signal Amplifier</span>
                            <span class="setting-hint">High = amplify weak signals</span>
                        </label>
                        <div class="setting-input">
                            <input type="range" id="settingBrightness" min="10" max="100" step="5" value="50">
                            <span class="setting-value" id="brightnessValue">50%</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>Thickness Amplifier</span>
                            <span class="setting-hint">High = thicker weak levels</span>
                        </label>
                        <div class="setting-input">
                            <input type="range" id="settingThickness" min="0.5" max="5" step="0.5" value="5">
                            <span class="setting-value" id="thicknessValue">5</span>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>EMA Period</span>
                            <span class="setting-hint">Period for EMA calculation (default: 20)</span>
                        </label>
                        <div class="setting-input">
                            <input type="number" id="settingEmaPeriod" min="1" max="200" step="1" value="20" class="number-input">
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>EMA Grid Spacing</span>
                            <span class="setting-hint">Multiplier (0.1 = EMA√ó1.1, 1.2...)</span>
                        </label>
                        <div class="setting-input">
                            <input type="number" id="settingEmaGridSpacing" min="0.001" max="1" step="0.001" value="0.003" class="number-input">
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>ZEMA Period</span>
                            <span class="setting-hint">Period for ZEMA calculation (default: 30)</span>
                        </label>
                        <div class="setting-input">
                            <input type="number" id="settingZemaPeriod" min="1" max="200" step="1" value="30" class="number-input">
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>
                            <span>ZEMA Grid Spacing</span>
                            <span class="setting-hint">Multiplier for ZEMA grid lines</span>
                        </label>
                        <div class="setting-input">
                            <input type="number" id="settingZemaGridSpacing" min="0.001" max="1" step="0.001" value="0.003" class="number-input">
                        </div>
                    </div>
                </div>
                
                <!-- Column 3: Colors -->
                <div class="settings-column">
                    <h3 class="settings-section-title">Chart Colors</h3>
                    
                    <div class="settings-group color-group">
                        <label>
                            <span>Price Bars</span>
                            <span class="setting-hint">Up / Down colors</span>
                        </label>
                        <div class="color-inputs">
                            <div class="color-input-wrapper">
                                <input type="color" id="colorBarUp" value="#10b981" title="Up bar color">
                                <span>Up</span>
                            </div>
                            <div class="color-input-wrapper">
                                <input type="color" id="colorBarDown" value="#ef4444" title="Down bar color">
                                <span>Down</span>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group color-group">
                        <label>
                            <span>Order Book Levels</span>
                            <span class="setting-hint">Support / Resistance colors</span>
                        </label>
                        <div class="color-inputs">
                            <div class="color-input-wrapper">
                                <input type="color" id="colorLevelSupport" value="#00d9ff" title="Support level color">
                                <span>Support</span>
                            </div>
                            <div class="color-input-wrapper">
                                <input type="color" id="colorLevelResistance" value="#ff006e" title="Resistance level color">
                                <span>Resist</span>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group color-group">
                        <label>
                            <span>Technical Indicators</span>
                            <span class="setting-hint">EMA / ZEMA line colors</span>
                        </label>
                        <div class="color-inputs">
                            <div class="color-input-wrapper">
                                <input type="color" id="colorEmaLine" value="#9ca3af" title="EMA line color">
                                <span>EMA</span>
                            </div>
                            <div class="color-input-wrapper">
                                <input type="color" id="colorZemaLine" value="#8b5cf6" title="ZEMA line color">
                                <span>ZEMA</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <div class="settings-actions">
                    <button class="btn-danger" id="clearCacheBtn">Clear Cache</button>
                    <button class="btn-secondary" id="resetSettings">Reset Defaults</button>
                    <button class="btn-primary" id="applySettings">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alerts Modal -->
    <div class="modal" id="alertsModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content alerts-modal-wide">
            <div class="modal-header">
                <h2>Alerts</h2>
                <div class="modal-header-actions">
                    <button class="btn-secondary btn-small" id="btnCreateAlertFromModal">New Alert</button>
                    <button class="modal-close" id="closeAlerts">&times;</button>
                </div>
            </div>
            <div class="modal-body alerts-modal-body">
                <div class="alerts-tabs">
                    <button class="alerts-tab active" data-tab="active">Active Alerts</button>
                    <button class="alerts-tab" data-tab="log">Alert Log</button>
                </div>
                <div class="alerts-tab-content active" data-tab-content="active">
                    <div class="alerts-list" id="activeAlertsList">
                        <div class="alerts-empty">No active alerts yet.</div>
                    </div>
                </div>
                <div class="alerts-tab-content" data-tab-content="log">
                    <div class="alerts-log-actions">
                        <button class="btn-secondary btn-small" id="clearAlertsLog" title="Clear this symbol's alert log">Clear Alert Log</button>
                    </div>
                    <div class="alerts-log" id="alertsLogList">
                        <div class="alerts-empty">No alerts fired yet.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Alert Modal -->
    <div class="modal" id="alertEditModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content alert-edit-modal">
            <div class="modal-header">
                <h2 id="alertEditTitle">Create Alert</h2>
                <button class="modal-close" id="closeAlertEdit">&times;</button>
            </div>
            <div class="modal-body">
                <form id="alertForm" class="alert-form">
                    <input type="hidden" id="alertId" value="">
                    <div class="alert-form-row">
                        <label>Section</label>
                        <select id="alertSection" class="alert-select"></select>
                    </div>
                    <div class="alert-form-row">
                        <label>Metric</label>
                        <select id="alertMetric" class="alert-select"></select>
                    </div>
                    <div class="alert-form-row">
                        <label>Custom message (optional)</label>
                        <textarea id="alertCustomMessage" class="alert-input alert-textarea" rows="3" placeholder="e.g. VWMP crossover ‚Äî watch reaction"></textarea>
                        <div class="alert-template-hints">
                            Tokens: <code>{symbol}</code> <code>{timeframe}</code> <code>{price}</code> <code>{mid}</code> <code>{vwmp}</code> <code>{ifv}</code> <code>{metric}</code> <code>{condition}</code> <code>{value}</code> <code>{compare}</code> <code>{auto}</code>
                        </div>
                        <div class="alert-template-hints subtle">
                            Tip: Use <code>{auto}</code> to embed the generated alert text inside your custom message.
                        </div>
                    </div>
                    <div class="alert-form-row alert-form-split">
                        <div class="alert-form-col">
                            <label>Condition</label>
                            <select id="alertCondition" class="alert-select"></select>
                        </div>
                        <div class="alert-form-col" id="alertThresholdWrap">
                            <label>Value</label>
                            <input type="number" id="alertThreshold" class="alert-input" step="0.0001">
                        </div>
                        <div class="alert-form-col" id="alertCompareMetricWrap" style="display:none">
                            <label>Compare To</label>
                            <select id="alertCompareMetric" class="alert-select"></select>
                        </div>
                        <div class="alert-form-col" id="alertTargetWrap" style="display:none">
                            <label>Value</label>
                            <select id="alertTarget" class="alert-select"></select>
                        </div>
                        <div class="alert-form-col" id="alertTextTargetWrap" style="display:none">
                            <label>Value</label>
                            <input type="text" id="alertTargetText" class="alert-input" placeholder="e.g. STRONG BUY">
                        </div>
                    </div>
                    <div class="alert-form-row">
                        <label>Frequency</label>
                        <select id="alertFrequency" class="alert-select">
                            <option value="one_time">One time</option>
                            <option value="once_per_bar">Once per bar</option>
                            <option value="once_per_min">Once per minute (until closed)</option>
                        </select>
                    </div>
                    <div class="alert-form-row alert-form-delivery">
                        <label>Delivery</label>
                        <div class="alert-delivery-options">
                            <label class="alert-check">
                                <input type="checkbox" id="alertNotify" checked>
                                <span>Browser notification</span>
                            </label>
                            <label class="alert-check">
                                <input type="checkbox" id="alertSound" checked>
                                <span>Sound</span>
                            </label>
                            <select id="alertSoundType" class="alert-select" title="Alert sound">
                                <option value="alarm" selected>Alarm (clock)</option>
                                <option value="beep">Beep</option>
                                <option value="chime">Chime</option>
                            </select>
                            <button type="button" class="btn-secondary btn-small" id="previewAlertSound" title="Preview sound">‚ñ∂Ô∏é</button>
                        </div>
                    </div>
                    <div class="alert-form-row alert-form-chart">
                        <label>Chart Marker</label>
                        <div class="alert-delivery-options">
                            <label class="alert-check">
                                <input type="checkbox" id="alertPlotOnChart">
                                <span>Plot on chart</span>
                            </label>
                            <select id="alertPlotShape" class="alert-select" title="Marker shape">
                                <option value="auto" selected>Auto</option>
                                <option value="arrowUp">Arrow Up</option>
                                <option value="arrowDown">Arrow Down</option>
                                <option value="circle">Circle</option>
                                <option value="square">Square</option>
                            </select>
                            <select id="alertPlotPosition" class="alert-select" title="Marker position">
                                <option value="auto" selected>Auto</option>
                                <option value="belowBar">Below bar</option>
                                <option value="aboveBar">Above bar</option>
                                <option value="inBar">In bar</option>
                            </select>
                            <input type="color" id="alertPlotColor" value="#fbbf24" title="Marker color">
                            <input type="text" id="alertPlotText" class="alert-input alert-plot-text" placeholder="Label (optional)" maxlength="10" title="Marker label">
                        </div>
                        <div class="alert-plot-warning" id="alertPlotWarning" style="display:none">
                            ‚ö† Chart markers share the same marker layer as other chart signals (BB Pulse / EMA/ZEMA / Forecast). On some timeframes, markers may overlap or look crowded.
                        </div>
                    </div>
                    <div class="alert-preview">
                        <span class="preview-label">Current:</span>
                        <span class="preview-value" id="alertCurrentValue">--</span>
                        <span class="preview-hint" id="alertCurrentHint"></span>
                    </div>
                    <div class="alert-preview alert-message-preview">
                        <span class="preview-label">Message preview:</span>
                        <span class="preview-value" id="alertMessagePreview">--</span>
                    </div>
                    <div class="alert-form-actions">
                        <button type="button" class="btn-secondary" id="cancelAlertEdit">Cancel</button>
                        <button type="submit" class="btn-primary" id="saveAlert">Save Alert</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Alerts Disclaimer (shown once) -->
    <div class="modal" id="alertsDisclaimerModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content alerts-disclaimer-content">
            <div class="modal-header">
                <h2>Alerts Notice</h2>
                <button class="modal-close" id="closeAlertsDisclaimer">&times;</button>
            </div>
            <div class="modal-body">
                <p class="alerts-disclaimer-text">
                    Since this is a browser app, the tab must stay open/active for alerts to work.
                </p>
                <label class="alerts-disclaimer-check">
                    <input type="checkbox" id="alertsDisclaimerCheck">
                    <span>I understand ‚Äî this tab must remain open/active for alerts to work.</span>
                </label>
                <div class="alerts-disclaimer-actions">
                    <button class="btn-secondary" id="alertsDisclaimerCancel">Cancel</button>
                    <button class="btn-primary" id="alertsDisclaimerContinue" disabled>Continue</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/db.js?v=20251217.17"></script>
    <script src="js/trade-aggregator.js?v=20251217.17"></script>
    <script src="js/websocket-orderbook.js?v=20251217.17"></script>
    <script src="js/orderbook-aggregator.js?v=20251217.17"></script>
    <script src="js/api.js?v=20251217.17"></script>
    <script src="js/websocket.js?v=20251217.17"></script>
    <script src="js/bb-pulse.js?v=20251217.17"></script>
    <script src="js/chart.js?v=20251217.17"></script>
    <script src="js/depth.js?v=20251217.17"></script>
    <script src="js/direction.js?v=20251217.17"></script>
    <script src="js/alpha-strike.js?v=20251217.17"></script>
    <script src="js/whale-flow.js?v=20251217.17"></script>
    <script src="js/app.js?v=20251217.17"></script>
    
    <!-- Global Tooltip Container -->
    <div id="globalTooltip" class="global-tooltip"></div>
    
    <script>
    // Global tooltip positioning
    document.querySelectorAll('.info-icon').forEach(icon => {
        const tooltipContent = icon.querySelector('.info-tooltip');
        if (!tooltipContent) return;
        
        const globalTooltip = document.getElementById('globalTooltip');
        
        icon.addEventListener('mouseenter', (e) => {
            globalTooltip.innerHTML = tooltipContent.innerHTML;
            globalTooltip.classList.add('visible');
            
            const rect = icon.getBoundingClientRect();
            const tooltipRect = globalTooltip.getBoundingClientRect();
            
            // Position to the right of the icon, or left if no room
            let left = rect.right + 10;
            if (left + 220 > window.innerWidth) {
                left = rect.left - 230;
            }
            
            let top = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
            // Keep within viewport
            if (top < 10) top = 10;
            if (top + tooltipRect.height > window.innerHeight - 10) {
                top = window.innerHeight - tooltipRect.height - 10;
            }
            
            globalTooltip.style.left = left + 'px';
            globalTooltip.style.top = top + 'px';
        });
        
        icon.addEventListener('mouseleave', () => {
            globalTooltip.classList.remove('visible');
        });
    });
    
    // Min gain input - trigger recalculation on change
    const minGainInput = document.getElementById('minGainPercent');
    const showTradeOnChart = document.getElementById('showTradeOnChart');
    
    // Load saved values from localStorage
    if (minGainInput) {
        const savedMinGain = localStorage.getItem('tradeSetup_minGain');
        if (savedMinGain) {
            minGainInput.value = savedMinGain;
        }
        
        minGainInput.addEventListener('change', () => {
            localStorage.setItem('tradeSetup_minGain', minGainInput.value);
            if (window.app && window.app.chart) {
                window.app.chart.updateFairValueIndicators();
            }
        });
        minGainInput.addEventListener('input', () => {
            clearTimeout(window.minGainTimeout);
            window.minGainTimeout = setTimeout(() => {
                localStorage.setItem('tradeSetup_minGain', minGainInput.value);
                if (window.app && window.app.chart) {
                    window.app.chart.updateFairValueIndicators();
                }
            }, 300);
        });
    }
    
    // Show trade on chart checkbox
    if (showTradeOnChart) {
        const savedShowTrade = localStorage.getItem('tradeSetup_showOnChart');
        showTradeOnChart.checked = savedShowTrade === 'true';
        
        showTradeOnChart.addEventListener('change', () => {
            localStorage.setItem('tradeSetup_showOnChart', showTradeOnChart.checked);
            if (window.app && window.app.chart) {
                window.app.chart.updateFairValueIndicators();
            }
        });
    }
    
    // Position selector buttons
    const positionLong = document.getElementById('positionLong');
    const positionShort = document.getElementById('positionShort');
    
    // Load saved position
    const savedPosition = localStorage.getItem('tradeSetup_position');
    if (savedPosition) {
        setTimeout(() => {
            if (window.app && window.app.chart) {
                window.app.chart.setUserPosition(savedPosition);
            }
        }, 1000);
    }
    
    if (positionLong) {
        positionLong.addEventListener('click', () => {
            if (window.app && window.app.chart) {
                const currentPos = window.app.chart.userSelectedPosition;
                // Toggle off if already selected, otherwise set to LONG
                window.app.chart.setUserPosition(currentPos === 'LONG' ? null : 'LONG');
            }
        });
    }
    
    if (positionShort) {
        positionShort.addEventListener('click', () => {
            if (window.app && window.app.chart) {
                const currentPos = window.app.chart.userSelectedPosition;
                // Toggle off if already selected, otherwise set to SHORT
                window.app.chart.setUserPosition(currentPos === 'SHORT' ? null : 'SHORT');
            }
        });
    }
    </script>

    <!-- Disclaimer Modal -->
    <div class="disclaimer-modal" id="disclaimerModal">
        <div class="disclaimer-backdrop"></div>
        <div class="disclaimer-content">
            <div class="disclaimer-header">
                <h2>‚ö†Ô∏è Important Disclaimer</h2>
            </div>
            <div class="disclaimer-body">
                <p><strong>Educational Purpose Only</strong></p>
                <p>This tool is provided strictly for educational and informational purposes. The data, analysis, and visualizations presented are not intended to constitute financial, investment, trading, or any other type of professional advice.</p>
                
                <p><strong>No Financial Advice</strong></p>
                <p>Nothing in this application should be construed as a recommendation to buy, sell, or hold any cryptocurrency or financial instrument. Always conduct your own research and consult with qualified financial advisors before making any investment decisions.</p>
                
                <p><strong>Use at Your Own Risk</strong></p>
                <p>You acknowledge that cryptocurrency trading involves substantial risk of loss. The creators and operators of this tool accept no responsibility for any financial losses or damages resulting from the use of this application.</p>
                
                <p><strong>License Agreement</strong></p>
                <p>This software is free for personal, non-commercial use only. Commercial reproduction or distribution is prohibited without license. For commercial licensing, contact <a href="mailto:daniel.boorn@gmail.com">daniel.boorn@gmail.com</a>.</p>
                
                <label class="disclaimer-checkbox">
                    <input type="checkbox" id="disclaimerAgree">
                    <span>I understand and agree to the above terms. I acknowledge this tool is for educational purposes only and does not constitute financial advice.</span>
                </label>
            </div>
            <div class="disclaimer-footer">
                <button class="disclaimer-btn" id="disclaimerAccept" disabled>Accept & Continue</button>
            </div>
        </div>
    </div>

    <script>
    // Disclaimer Modal Logic
    (function() {
        const STORAGE_KEY = 'orderbook_disclaimer_accepted';
        const modal = document.getElementById('disclaimerModal');
        const checkbox = document.getElementById('disclaimerAgree');
        const acceptBtn = document.getElementById('disclaimerAccept');
        
        // Check if already accepted
        if (localStorage.getItem(STORAGE_KEY) === 'true') {
            modal.style.display = 'none';
            return;
        }
        
        // Show modal
        modal.classList.add('open');
        
        // Enable button when checkbox is checked
        checkbox.addEventListener('change', function() {
            acceptBtn.disabled = !this.checked;
        });
        
        // Accept and remember
        acceptBtn.addEventListener('click', function() {
            if (checkbox.checked) {
                localStorage.setItem(STORAGE_KEY, 'true');
                modal.classList.remove('open');
                setTimeout(() => modal.style.display = 'none', 300);
            }
        });
    })();
    </script>
</body>
</html>



